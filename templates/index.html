<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker AI</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸŽ¯ Habit Tracker AI</h1>
            <p class="subtitle">Track habits, set goals, get AI insights</p>
        </header>

        <!-- Week Navigation -->
        <div class="week-nav">
            <button id="prev-week" class="btn btn-secondary">&larr; Previous</button>
            <div id="week-label">This Week</div>
            <button id="next-week" class="btn btn-secondary">Next &rarr;</button>
        </div>

        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">{{ "%.0f"|format(stats.completion_rate * 100) }}%</div>
                <div class="stat-label">Completion Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ stats.total_logs }}</div>
                <div class="stat-label">Total Logs</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ stats.completed }}</div>
                <div class="stat-label">Completed</div>
            </div>
        </div>

        <!-- AI Insights -->
        <div class="section">
            <div class="section-header">
                <h2>ðŸ¤– AI Insights</h2>
                <button id="refresh-insights" class="btn btn-secondary">Refresh</button>
            </div>
            <div id="insights" class="insights-box">
                Loading insights...
            </div>
        </div>

        <!-- Weekly Goals Calendar -->
        <div class="section">
            <div class="section-header">
                <h2>ðŸ“… Weekly Goals</h2>
                <div class="header-buttons">
                    <button id="add-habit-btn" class="btn btn-primary">+ Add Habit</button>
                    <button id="add-goal-btn" class="btn btn-primary">+ Add Goal</button>
                </div>
            </div>

            <div id="calendar" class="calendar-grid">
                <!-- Calendar will be built dynamically by JavaScript -->
            </div>

            <!-- Today's Habits (Dropdown) -->
            <div class="today-habits-wrapper">
                <h3>âœ… Today's Habits</h3>
                <select id="habit-dropdown" class="habit-dropdown">
                    <option value="">Select a habit to check off...</option>
                    <!-- Options will be populated by JavaScript -->
                </select>
                
                <!-- Selected Habit Details -->
                <div id="selected-habit-details" class="selected-habit-details" style="display: none;">
                    <div class="selected-habit-header">
                        <h4 id="selected-habit-name">Habit Name</h4>
                        <button id="delete-selected-habit" class="btn btn-delete">Delete</button>
                    </div>
                    <div class="selected-habit-actions">
                        <div class="habit-status">
                            <label class="checkbox">
                                <input type="checkbox" id="selected-habit-checkbox">
                                <span>Completed today</span>
                            </label>
                        </div>
                        <div class="habit-streak" id="selected-habit-streak"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="section">
            <h2>ðŸ“Š Recent Activity</h2>
            <div id="recent-activity" class="activity-list">
                {% for log in logs[:10] %}
                <div class="activity-item">
                    <span class="activity-date">{{ log.date }}</span>
                    <span class="activity-habit" style="color: {{ log.habit_color }}">
                        {{ log.habit_name }}
                    </span>
                    <span class="activity-status">
                        {{ "âœ“" if log.completed else "âœ—" }}
                    </span>
                </div>
                {% endfor %}

                {% if not logs %}
                <div class="empty-state">
                    <p>No activity yet. Start tracking your habits! ðŸŽ¯</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Add Habit Modal -->
    <div id="add-habit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Habit</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="add-habit-form">
                <div class="form-group">
                    <label for="habit-name">Habit Name</label>
                    <input type="text" id="habit-name" required placeholder="e.g., Exercise, Read, Code">
                </div>
                <div class="form-group">
                    <label for="habit-color">Color</label>
                    <input type="color" id="habit-color" value="#007bff">
                </div>
                <button type="submit" class="btn btn-primary">Add Habit</button>
            </form>
        </div>
    </div>

    <!-- Add Goal Modal -->
    <div id="add-goal-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Goal</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="add-goal-form">
                <div class="form-group">
                    <label for="goal-habit">Habit</label>
                    <select id="goal-habit" required>
                        <option value="">Select a habit...</option>
                        {% for habit in habits %}
                        <option value="{{ habit.id }}">{{ habit.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="goal-date">Date</label>
                    <input type="date" id="goal-date" required>
                </div>
                <div class="form-group">
                    <label for="goal-target">Target Count</label>
                    <input type="number" id="goal-target" min="1" value="1" required>
                </div>
                <div class="form-group">
                    <label for="goal-notes">Notes (optional)</label>
                    <textarea id="goal-notes" rows="2" placeholder="Add any notes..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Add Goal</button>
            </form>
        </div>
    </div>

    <!-- Day Goals Modal -->
    <div id="day-goals-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="day-modal-title">Goals for Date</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div id="day-goals-list" class="day-goals-list">
                <!-- Goals for selected day will be loaded here -->
            </div>
            <button id="add-goal-from-day" class="btn btn-primary">+ Add Goal for This Day</button>
        </div>
    </div>

    <script>
        // Store initial data from server
        window.initialHabits = [
            {% for habit in habits %}
            { "id": {{ habit.id }}, "name": "{{ habit.name }}", "color": "{{ habit.color }}" },
            {% endfor %}
        ];
        
        // Store streaks and today_logs for habit dropdown
        window.streaks = [
            {% for streak in streaks %}
            { "id": {{ streak.id }}, "current_streak": {{ streak.current_streak }} },
            {% endfor %}
        ];
        
        window.todayLogs = {
            {% for log in logs if log.date == today %}
            {{ log.habit_id }}: { "completed": {{ "true" if log.completed else "false" }} },
            {% endfor %}
        };
    </script>
    <script src="/static/app.js"></script>
</body>
</html>

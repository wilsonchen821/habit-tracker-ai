<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker AI</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸŽ¯ Habit Tracker AI</h1>
            <p class="subtitle">Track habits, set goals, get AI insights</p>
        </header>

        <!-- Week Navigation -->
        <div class="week-nav">
            <button id="prev-week" class="btn btn-secondary">&larr; Previous</button>
            <div id="week-label">This Week</div>
            <button id="next-week" class="btn btn-secondary">Next &rarr;</button>
        </div>

        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">{{ "%.0f"|format(stats.completion_rate * 100) }}%</div>
                <div class="stat-label">Completion Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ stats.total_logs }}</div>
                <div class="stat-label">Total Logs</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ stats.completed }}</div>
                <div class="stat-label">Completed</div>
            </div>
        </div>

        <!-- AI Insights -->
        <div class="section">
            <div class="section-header">
                <h2>ðŸ¤– AI Insights</h2>
                <button id="refresh-insights" class="btn btn-secondary">Refresh</button>
            </div>
            <div id="insights" class="insights-box">
                Loading insights...
            </div>
        </div>

        <!-- Weekly Goals Calendar -->
        <div class="section">
            <div class="section-header">
                <h2>ðŸ“… Weekly Goals</h2>
            </div>

            <div id="calendar" class="calendar-grid">
                <!-- Calendar will be built dynamically by JavaScript -->
            </div>
        </div>

        <!-- My Habits -->
        <div class="section">
            <div class="section-header">
                <h2>âœ… My Habits</h2>
                <div class="header-buttons">
                    <button id="add-habit-btn" class="btn btn-primary">+ Add Habit</button>
                    <button id="add-goal-btn" class="btn btn-primary">+ Add Goal</button>
                </div>
            </div>

            <div id="my-habits-list" class="my-habits-grid">
                {% for habit in habits %}
                <div class="habit-card-inline" style="border-left: 4px solid {{ habit.color }}">
                    <div class="habit-header-inline">
                        <span class="habit-name-inline">{{ habit.name }}</span>
                        <button class="btn-delete-inline" data-habit-id="{{ habit.id }}">Delete</button>
                    </div>
                    <div class="habit-streak-inline">
                        {% for streak in streaks if streak.id == habit.id %}
                            {% if streak.current_streak > 0 %}
                                <span class="streak-badge">ðŸ”¥ {{ streak.current_streak }} day streak</span>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <div class="habit-status-inline">
                        <label class="checkbox">
                            <input type="checkbox" data-habit-id="{{ habit.id }}"
                                {% if today_logs.get(habit.id) and today_logs[habit.id].completed %}checked{% endif %}>
                            <span>Completed today</span>
                        </label>
                    </div>
                </div>
                {% endfor %}

                {% if not habits %}
                <div class="empty-state">
                    <p>No habits yet. Add your first habit! ðŸš€</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="section">
            <h2>ðŸ“Š Recent Activity</h2>
            <div id="recent-activity" class="activity-list">
                {% for log in logs[:10] %}
                <div class="activity-item">
                    <span class="activity-date">{{ log.date }}</span>
                    <span class="activity-habit" style="color: {{ log.habit_color }}">
                        {{ log.habit_name }}
                    </span>
                    <span class="activity-status">
                        {{ "âœ“" if log.completed else "âœ—" }}
                    </span>
                </div>
                {% endfor %}

                {% if not logs %}
                <div class="empty-state">
                    <p>No activity yet. Start tracking your habits! ðŸŽ¯</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Add Habit Modal -->
    <div id="add-habit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Habit</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="add-habit-form">
                <div class="form-group">
                    <label for="habit-name">Habit Name</label>
                    <input type="text" id="habit-name" required placeholder="e.g., Exercise, Read, Code">
                </div>
                <div class="form-group">
                    <label for="habit-color">Color</label>
                    <input type="color" id="habit-color" value="#007bff">
                </div>
                <button type="submit" class="btn btn-primary">Add Habit</button>
            </form>
        </div>
    </div>

    <!-- Add Goal Modal -->
    <div id="add-goal-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Goal</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="add-goal-form">
                <div class="form-group">
                    <label for="goal-habit">Habit</label>
                    <select id="goal-habit" required>
                        <option value="">Select a habit...</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="goal-date">Date</label>
                    <input type="date" id="goal-date" required>
                </div>
                <div class="form-group">
                    <label for="goal-target">Target Count</label>
                    <input type="number" id="goal-target" min="1" value="1" required>
                </div>
                <div class="form-group">
                    <label for="goal-notes">Notes (optional)</label>
                    <textarea id="goal-notes" rows="2" placeholder="Add any notes..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Add Goal</button>
            </form>
        </div>
    </div>

    <!-- Day Goals Modal -->
    <div id="day-goals-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="day-modal-title">Goals for Date</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div id="day-goals-list" class="day-goals-list">
                <!-- Goals for selected day will be loaded here -->
            </div>
            <button id="add-goal-from-day" class="btn btn-primary">+ Add Goal for This Day</button>
        </div>
    </div>

    <script>
        // Store initial data from server
        window.initialHabits = [
            {% for habit in habits %}
            { "id": {{ habit.id }}, "name": "{{ habit.name }}", "color": "{{ habit.color }}" },
            {% endfor %}
        ];
        
        // Store streaks and today_logs for habit list
        window.streaks = [
            {% for streak in streaks %}
            { "id": {{ streak.id }}, "current_streak": {{ streak.current_streak }} },
            {% endfor %}
        ];
        
        window.todayLogs = {
            {% for log in logs if log.date == today %}
            {{ log.habit_id }}: { "completed": {{ "true" if log.completed else "false" }} },
            {% endfor %}
        };
    </script>
    <script src="/static/app.js"></script>
</body>
</html>
